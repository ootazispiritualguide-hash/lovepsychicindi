<%- include('../partials/admin-header') %>
<%- include('../partials/admin-sidebar') %>

<div style="margin-left:240px; padding:24px">

<section class="py-5">
  <div class="container">
    <h3 class="mb-4 fw-bold">Add New Blog Post</h3>

    <!-- IMPORTANT: enctype added -->
    <form action="/posts/post_add" method="POST" enctype="multipart/form-data">

      <div class="mb-3">
        <label class="form-label">Title*</label>
        <input type="text" name="title" class="form-control" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Category*</label>
        <input type="text" name="category" class="form-control" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Slug*</label>
        <input type="text" name="slug" class="form-control" required>
        <small class="text-muted">Example: love-psychic-reading-tips</small>
      </div>

      <!-- IMAGE UPLOAD FIELD -->
      <div class="mb-3">
        <label class="form-label">Featured Image</label>
        <input type="file" name="image" id="imageInput" class="form-control" accept="image/*">
        <img id="imagePreview" class="image-preview" alt="Preview">
      </div>

      <div class="mb-3">
        <label class="form-label">Content*</label>
        <textarea name="content" class="form-control" rows="6" required></textarea>
      </div>

      <button class="btn btn-primary px-4">Add Post</button>
    </form>

    <a href="/posts" class="btn btn-outline-secondary mt-3">Back to Blog</a>
  </div>
</section>

<!-- SIMPLE JS PREVIEW -->
<script>
  const input = document.getElementById('imageInput');
  const preview = document.getElementById('imagePreview');

  input?.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) {
      preview.style.display = 'none';
      preview.src = '';
      return;
    }
    const reader = new FileReader();
    reader.onload = (ev) => {
      preview.src = ev.target.result;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });
</script>
